FROM gradle:7.1.0-jdk16 AS BUILD
#Gradle docker has gradle user as default
USER root

WORKDIR /app
COPY . /app

ENV LOGGING_FILE log/production.log

RUN mkdir -p /app
RUN chown -R gradle /app

USER gradle

RUN gradle :build -x test -x pmdMain -x checkstyleMain -x pmdTest -x check

FROM openjdk:16-jdk-slim

WORKDIR /app
COPY --from=BUILD /app/build/ ./
RUN rm -rf classes distributions tmp
# This probably should not have a static path, but instead build in a custom path.
CMD sleep 5 && java -jar libs/gamma-1.0.0-SNAPSHOT.jar
